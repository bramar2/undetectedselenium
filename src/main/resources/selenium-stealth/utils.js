// https://github.com/berstend/puppeteer-extra/blob/c44c8bb0224c6bba2554017bfb9d7a1d0119f92f/packages/puppeteer-extra-plugin-stealth/evasions/_utils/index.js
// Compressed
()=>{(utils={}).stripProxyFromErrors=(t={})=>{let r={},e=Object.getOwnPropertyNames(t);return e.forEach(e=>{r[e]=function(){try{return t[e].apply(this,arguments||[])}catch(r){if(!r||!r.stack||!r.stack.includes("at "))throw r;let o=t=>{let o=[`at Reflect.${e} `,`at Object.${e} `,`at Object.newHandler.<computed> [as ${e}] `];return r.stack.split("\n").filter((t,r)=>1!==r).filter(t=>!o.some(r=>t.trim().startsWith(r))).join("\n")},i=t=>{let r=t.split("\n"),o=`at Object.newHandler.<computed> [as ${e}] `,i=r.findIndex(t=>t.trim().startsWith(o));return -1!==i&&(r.splice(1,i),r.join("\n"))};throw r.stack=i(r.stack)||o(r.stack),r}}}),r},utils.stripErrorWithAnchor=(t,r)=>{let e=t.stack.split("\n"),o=e.findIndex(t=>t.trim().startsWith(r));return -1===o||(e.splice(1,o),t.stack=e.join("\n")),t},utils.replaceProperty=(t,r,e={})=>Object.defineProperty(t,r,{...Object.getOwnPropertyDescriptor(t,r)||{},...e}),utils.preloadCache=()=>{!utils.cache&&(utils.cache={Reflect:{get:Reflect.get.bind(Reflect),apply:Reflect.apply.bind(Reflect)},nativeToStringStr:Function.toString+""})},utils.makeNativeString=(t="")=>(utils.preloadCache(),utils.cache.nativeToStringStr.replace("toString",t||"")),utils.patchToString=(t,r="")=>{utils.preloadCache();let e=new Proxy(Function.prototype.toString,{apply:function(e,o){if(o===Function.prototype.toString)return utils.makeNativeString("toString");if(o===t)return r||utils.makeNativeString(t.name);let i=Object.getPrototypeOf(Function.prototype.toString).isPrototypeOf(o.toString);return i?e.call(o):o.toString()}});utils.replaceProperty(Function.prototype,"toString",{value:e})},utils.patchToStringNested=(t={})=>utils.execRecursively(t,["function"],utils.patchToString),utils.redirectToString=(t,r)=>{utils.preloadCache();let e=new Proxy(Function.prototype.toString,{apply:function(e,o){if(o===Function.prototype.toString)return utils.makeNativeString("toString");if(o===t){let i=()=>r&&r.name?utils.makeNativeString(r.name):utils.makeNativeString(t.name);return r+""||i()}let n=Object.getPrototypeOf(Function.prototype.toString).isPrototypeOf(o.toString);return n?e.call(o):o.toString()}});utils.replaceProperty(Function.prototype,"toString",{value:e})},utils.replaceWithProxy=(t,r,e)=>{utils.preloadCache();let o=t[r],i=new Proxy(t[r],utils.stripProxyFromErrors(e));return utils.replaceProperty(t,r,{value:i}),utils.redirectToString(i,o),!0},utils.mockWithProxy=(t,r,e,o)=>{utils.preloadCache();let i=new Proxy(e,utils.stripProxyFromErrors(o));return utils.replaceProperty(t,r,{value:i}),utils.patchToString(i),!0},utils.createProxy=(t,r)=>{utils.preloadCache();let e=new Proxy(t,utils.stripProxyFromErrors(r));return utils.patchToString(e),e},utils.splitObjPath=t=>({objName:t.split(".").slice(0,-1).join("."),propName:t.split(".").slice(-1)[0]}),utils.replaceObjPathWithProxy=(objPath,handler)=>{let{objName,propName}=utils.splitObjPath(objPath),obj=eval(objName);return utils.replaceWithProxy(obj,propName,handler)},utils.execRecursively=(t={},r=[],e)=>{function o(t){for(let i in t)void 0!==t[i]&&(t[i]&&"object"==typeof t[i]?o(t[i]):t[i]&&r.includes(typeof t[i])&&e.call(this,t[i]))}return o(t),t},utils.stringifyFns=(t={hello:()=>"world"})=>{function r(t){return[...t].reduce((t,[r,e])=>(t[r]=e,t),{})}return(Object.fromEntries||r)(Object.entries(t).filter(([t,r])=>"function"==typeof r).map(([t,r])=>[t,r.toString()]))},utils.materializeFns=(fnStrObj={hello:"() => 'world'"})=>Object.fromEntries(Object.entries(fnStrObj).map(([key,value])=>value.startsWith("function")?[key,eval(`() => ${value}`)()]:[key,eval(value)])),utils.preloadCache(),globalThis.window.utils=utils}
